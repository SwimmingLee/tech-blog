# 네트워크 :e-mail:
네트워크가 어떤 식으로 인프라를 구축해야하는지 정리해서 올릴 것 

2. 네트워크의 전체 그림! OSI 7 계층

   1. 이더넷과 OSI 7 계층은 엄밀히는 다르다!

      1. OSI 7계층은 개발자 들의 이해를 돕기 위한 개념적인것, 이더넷 공식 문서와는 다르다.

      2. 이더넷은 IEEE 820.3 표준의 일부인 프레임 기반, 혹은 데이터 패킷 기반 네트워킹 기술이다

      3. Ethernet은 전세계 학교, 가정, 사무실에서 가장 많이 활용되는 네트워크 규격입니다. 

         이녀석은 OSI 모델 7계층 중 물리 계층(신호와 배선)과 데이터 링크 계층(MAC 패킷, 프로토콜 형식)에서 그 구성 형식이 정의되죠.

   2. 단간한 계층소개

      1. 응용 프로그램 세트  (응용, 표현, 세션)
      2. 전송계층
      3. 네트워크계층
         1. IP로 주소를 찾는다!
      4. 데이터링크 계층
         1. MAC으로 찾는다. 
      5. 물리 계층

3. MAC과 IP면 어디든 통신할 수 있다.

   1. L2 switch
   1. ARP
      2. 포워딩 테이블 
2. L3 Router
   
   1. ICMP: IP를 가진 Host와 통신이 되는지 확인!
   
4. 신뢰성 있는 통신을 하고 싶다. TCP

   1. 왜? 현금거래..
   2. 그렇다면 네트워크 문제들은 어떤 것들이 있나.?
      1. 신호감쇄, 고장 -> 오류
      2. 처리율 차이 -> 흐름
      3. 혼잡하다. 혼잡해 -> 혼잡
   3. TCP 소개! 3-Way 핸드쉐이킹, 4-Way핸드쉐이킹
   4. 흐름제어
      1. stop & wait (ack!!) 
      2.  효율적으로 하고 싶다. 슬라이딩 윈도우
   5. 오류제어
      1. timeout!
      2. ack로 인한 오류제어!
      3. CRC
   6. 혼잡제어
      1. 슬라이딩 윈도우 사이즈르 점점 늘린다!!
      2. MSS

5. IP가 부족해!! IP 긴급 수혈이 필요하다. 공유기

   1. 공유기는 사설IP를 다수의 Host가 공용 IP한개로 나눠 쓰는 것
   2. DHCP
   3. 네크워크 주소 변환(NAT 테이블)

6. 무선으로 가자! Wi-Fi(Wi-Fi 이름 유래)

   1. 무선으로 데이터 송/수신하는데 문제는 무엇이 있을까

      1. 감쇄
      2. 마이크로 그림자
      3. 다중 경로 간섭
      4. 채널 혼잡
      5. 타 무선 기술과의 간섭
      6. 숨겨진 노드 문제

   2.  WI-FI 간략한 개요

      1. WI-FI 채널
      2. 2.4GHZ , 5GHZ

   3. 충돌감지? 충동 회피?

      1. 출돌 회피!
      2. 캐리어 감지 및 숨겨진 노드 문제

   4. wi-FI 연결 원리

      1. 스캔, 인증, 결합 
      2. rsA 알고리즘 

   5. WI-FI 보안

      1. 암호화!
      2. WEP
      3. WPA
      4. WPA-2(그리고 WPS)




우리는 뉴스를 보고, 관심있는 영상을 보면서 매일매일 인터넷을 이용한다. 인터넷을 이용하는데에는 인터넷이 어떻게 돌아가는지 몰라도 된다. 그래도 개발자라면, 인터넷을 활용하여 서비스를 제작하는 개발자라면 어떻게 멀리있는 상대와 정보를 주고받는 것인지 알 필요가 있다. 



## 네트워크는 택배시스템과 같다

네트워크는 생각보다 택배 시스템이랑 비슷하다. 택배를 보낸다고 생각해보자. 

우선, 택배를 보내기 위해서는 상대방 주소가 필요하다. 네트워크 상에서 데이터를 전송하기 위해선 주소가 필요한데, 이게 바로 IP와 MAC이다. 실제로, IP와 MAC만 알면 어느 지역에 있간에 통신할 수 있다. 그렇다면 이 주소를 통해서 어떻게 데이터를 전송할 수 있을까?



#### WAN과 LAN

천안시 홍길동이 천안시 유비에게 택배를 보낸다고 생각해보자. 같은 천안시 내에 있기 때문에, 이름만 알면 바로 배송할 수 있다(고 생각해보자)

그런데 부산에 있는 친구에게 택배를 보낸다고 해보자. 그러면 여러 물류창고를 거치가면서 배송이 되게 된다. 이때는 정확한 주소 정보가 필요하다. 

이처럼 천안시 내에서 택배를 보내는 것처럼 같은 네트워크에 속하는 것은 LAN(Local Area Network)이라고 한다. 그리고 이름이 바로 MAC 주소이다. 즉, LAN은 하나의 네트워크에서 여러 장치가 맡물려서 MAC으로 통신하는 방법이다. 그리고 천안에서 부산으로 택배를 보내는 것으로 네트워크 상에서 외부로 나가면서 통신하는 것을 WAN(Wide Area Network)라고 한다.  여기서 시가 바로 IP에 해당한다.

> L2 스위치는 LAN에서 서로 통신할 때,
>
> L3 라우터는 WAN으로 외부 네트워크로 나갈 때 필요하다.



#### WAN과 LAN의 차이, 서브넷 마스크

택배 시스템을 예시로 들었지만, 실제 네트워크에서는 WAN과 LAN을 무엇을 기준으로 구분할까? 바로 `서브넷 마스크`를 기준으로 한다. 서브넷 마스크는 IP를 `네트워크 영역`과 `호스트 영역`으로 구분하는 방식이다.  

![image-20200703221320743](C:\Users\swimm\AppData\Roaming\Typora\typora-user-images\image-20200703221320743.png)

> IPv4 주소와 서브넷 마스크를 AND연산해서 나오는 부분이 네트워크 영역, 나머지 부분이 호스트 영역이다. 위 예시에서는 192.168.219.3에서 192.168.219이 네트워크 영역, 101이 호스트 영역이 된다.

IP를 서브넷 마스크와 AND 연산하였을 때, 같은 주소가 나오면 LAN에 속해 있는 것이다. 아니면 WAN인 것이다. 

1990년대 후반부터 인터넷이 지배적인 WAN으로 등극하였고, LAN은 이더넷이 지배하게 되었다. 이제 어떤 방식으로 통신이 이뤄지는지 자세히 살펴보고자 한다. 그 전에 일단 네트워크의 개념은 OSI 7계층에 대해서 알아보도록 하자.



## 네트워크의 전체적인 개요! OSI 7계층

OSI 7계층은 개발자의 이해를 돕기위한 네트워크 통신의 흐름을 추상화한 것이다. 

![image-20200703221510578](C:\Users\swimm\AppData\Roaming\Typora\typora-user-images\image-20200703221510578.png)

OSI 모델의 네트워크 상의 데이터 전송을 추상화하여 분류한 모델이다. 각 계층은 개념적인 하위 수준의 정확한 세부 사항에 의존하지 않고, 다른 링크의 해당 계층(피어)와 직접 통신한다. 즉, 한 계층을 수정한다고 다른 계층에 영향을 주지 않는다. 



#### 간단한 계층 소개

- L5-L7 Application Program set 
  - 응용 프로그램 상에서 통신을 위한 프로토콜, 암호화, 압축 등이 모두 포함
- L4 Transport Layer
  - 두 프로세스 사이의 데이터 스트림의 안전성 보장. 수신측에서 받은 세그먼트의 순서가 잘못되면 이를 재정렬하는 프로토콜에 포함
  - 네트워크 과정에서 손실되거나 손상된 세그먼트를 탐지하고 재전송 요청
  - 송신기가 수신에서 처리할 수 있는 것보다 빠르게 데이터를 전송하지 못하도록 흐름 제어 
- L3 Network Layer
  - 다른 호스트로 이동하는 동안 어떤 경로로 취할 것인지 결정
  - 네트워크 경로는 보통 하나 이상의 정류장을 두며, 경로 상의 컴퓨터가 이 정류장에 해당된다. 
- L2 DataLink Layer
  - 로컬 네트워크의 직접적인 연결을 통해 데이터 흐름 관리
  - 두 개의 인접한 개방 시스템간의 효율적인 통신을 위해 흐름제어, 프레임 동기화, 오류 제어, 순서 제어 기능을 한다. 
  - MAC으로 서로를 찾는다.
- L1 Physical Layer
  - 네트워크 연결이 물리적으로 형성되는 곳



## MAC과 IP만 알면 어디든 통신할 수 있다!

내가 생대방의 컴퓨터에게 데이터를 전송하고자 한다. 상대방 MAC이랑 IP 주소가 필요하다. 그런데 IP 주소는 알지는 상대방 MAC 주소는 모른다. IP와 마찬가지로 MAC도 통신을 위한 식별자로 사용되지만 상대방 MAC 주소를 직접적으로 넣어주지 않아도 된다. L2 스위치가 해당 IP와 MAC주소를 매핑하여 가지고 있기 때문이다. 그럼 L2 스위치는 어떻게 IP 주소만으로 MAC주소를 얻어 올 수 있을까? 이를 해결하기 위한 방법이 `ARP 알고리즘`이다. 그리고 IP를 가진 호스트와 통신이 되는지 확인하기 위한 방법으로는 `ICMP`를 활용한다. 

#### ARP(Address Resolution Protocol)

L2 스위치는 브로드 캐스팅으로 특정 아이피를 가지고 있는 컴퓨터의 MAC 주소를 알려주세요.라는 신호를 보낸다. 응답을 들은 컴퓨터는 자신의 IP가 해당 IP가 아니라면 신호를 무시한다. 

IP가 맞으면 자신의 MAC주소를 L2 스위치에게 보내게 되면 스위치는 두 가지 업무를 수행한다. 

- 포워딩 테이블을 채운다. 각 포트와 맥 주소를 매칭시킨다.
- ARP 테이블을 채운다. 각 MAC주소와 IP를 매칭시킨다.

그러면 ARP 테이블을 보고 바로 해당 MAC 주소를 가진 컴퓨터에게 바로 데이터를 전송해 줄 수 있다. IP를 가진 호스트와 통신이 되는지 확인하기 위해서 WAN을 통해 나가야 할 때도 있다. 그러면 게이트웨이를 통해 외부 네트워크로 나가서 데이터를 전송해야 한다. WAN으로 다른 영역에 있는 컴퓨터에 통신하기 위해서는 디폴트 게이트웨이의 맥 주소를 적게 된다. 

L2는 정말로 MAC 주소만 보면 된다. 그 이상 뜯어볼 필요도 없다. 자기 역할에만 충실하면 된다.



### ICMP(Internet Control Message Protocol)

ICMP: IP를 가진 Host와 통신이 되는지 확인

ex) ping 192.158.33.35



## 어디든 가든건 좋아! 이제는 신뢰성까지 보장받고 싶어! 

네트워크에서 신뢰성이 왜 중요할까. 은행 전상망에 대해서 생각해보자. A가 B에게 500만원을 상대방에게 보내는 상황이라고 가정해보자. 신호에 잡음이 생겨서 5000만원을 보내놓고 거래가 성사되었다고 말할 수도 있다. 그러면 정말 큰일이다. 매우 끔찍하다! 네트워크 신뢰성을 갖춰야 비지니스에 적용할 수 있다. 그렇다면 네크워크 신뢰성을 해치는 오류는 무엇이 있을까?

### 네트워크 문제들은 어떤 것들이 있나?

1. 신호 감쇠, 재변으로인한 신호 고장

   선이 길수록 신호가 왜곡되거나 손실되는 경우가 발생한다. 그걸 보완하기 위해 L1 계층의 리피터가 존재한다. 그렇다고 하더라도 상대바에게 내가 원하는 정보를 백프로 연결했따고 확정 지을 수 없다. (번개가 치는 자연재해 등으로도 신호에 노이즈가 낄 수 있다.)

2. 각 단말간 처리율 차이

   양 끝단에서 처리하는 속도가 다를 수 있기 때문에 이를 맞춰주어야 한다. 송순기가 수신에서 처리할 수 있는 것보다 빠르게 데이터를 전송하기 못할 때 통신속도를 맞춰주는 제어가 필요하다. 

3. 여러 단말끼리 송수신이 복잡하여 혼잡되는 상황

   양 끝단 말도고 라우터에서 처리할 수 없는 상황이라면 어떻게 해야할까? 트래팍잼이 발생하게 되고 이럴 떄는 각각 서로 양보햐야 한다. 이렇게 혼잡한 상황 속에서도 제어할 수 있는 방식이 필요하다. 

그러면 이러한 상황을 각각 해결해야 한다. TCP에서는 위 문제를 해결하기 위해 여러 제어방식을 사용한다. 신호 감쇠 및 고장은 `오류제어`로, 각 단말간 처리율을 맞추는 것은 `흐름제어`로, 여러 단말에서 신호를 보내면서 혼잡한 경우에는 `혼잡제어`로 처리한다. TCP는 어떻게 진행되길래 제어 알고리즘을 적용할 수 있는지 알아보자. 

  

### TCP 소개, 3-way, 4-way 핸드 쉐이킹

TCP는 두 프로세스 사이의 데이터 스트림의 안정성이 보장되며, 수신측에서는 받은 세그먼트의 순서가 잘못되었을 때 이를 재정렬하는 매커니즘이 프로토콜에 포함된다. 이 밖에도 네트워크 전송 과정에서 손실되거나 손상된 세그먼트를 탐지하고 재전송을 요청할 수 있다. 

![image-20200703091753104](C:\Users\swimm\AppData\Roaming\Typora\typora-user-images\image-20200703091753104.png)



TCP에서 연결지향성을 보장받기 위해서 3-way 핸드쉐이킹 방식을 사용하는데 정말 간단하다.  세 단계에 걸쳐서 연결확인을 물어보게 된다. 

1) 클라이언트: 서버님 잘 들리시나요? (SYN)

2) 서버: 클라이언트님 잘 들려요! 클라이언트님도 잘 들리시나요? (SYN + ACK)

3) 클라이언트: 네 저도 잘들립니다. (ACK)

>  SYN: Synchronize sequence numbers
>
>  ACK: Acknowledgement



### 흐름 제어

TCP에서 단말간 흐름제어를 하려면 어떻게 할까? 

하나는 데이터 스트림을 `세그먼트 단위로 나누는 것`이다. 데이터 스트림을 여러 세그먼트 단위로 나누어서 유동적으로 조각의 흐름을 제어한다.

또 하나는 `stop & wait `를 사용하는 방식이다. ACK를 통해 상대방이 수신을 완료했다는 신호를 받기 전까지 대기하였다가, 받으면 다음 패킷을 보낸다. 그냥 세그먼트 단위로 그냥 보내면 효율이 매우 떨어지기 떄문에, 수신측이 한 번에 처리할 수 있는 데이터를 정해놓고 그때그때 데이터 흐름을 제어한다. 이때, 한 번에 처리할 수 있는 데이터 공간을  `슬라이드 윈도우`라고 한다. 이 슬라이드 윈도우는 세그먼트 헤더에 윈도우 필드를 두고 이 필드에서 연결의 각 끝에 허용할 수 있는 데이터를 보내는 방식이다.

#### 단말간 흐름 제어를 위한 버퍼 확인

>  seq 1024, win 2048
>
> -> seq부터 len길이만큼 전송해줘!
>
> ack 1025, win 1024
>
> -> 1025부터 줘 내 용량은 이제 1024 남았어

### 오류 제어

TCP 오류 제어는 전송한 데이터 신호가 왜곡되었는지, 손실되었는지 찾아내서 재선송을 요청하는 방식이다. 신호의 왜곡과 손실을 찾는 방법은 timeout, ack, crc를 통해서 확인할 수 있다.

#### Timeout에 인한 오류제어

  TCP 프로토콜은 상대방이 신호를 받으면 잘 받았다고 ack 신호를 보내준다. 잘 받았다는 신호를 보내주는데 여기서 잘 보내주지 않으면 시간을 기달렸다가 다시 보내게 된다. 상대방이 데이터를 수신하고 정해진 시간동안 ACK를 주지 않으면 timeout이 발생한다. timeout이 발생하면 데이터 손실이 발생했다고 인지하고 다시 데이터를 전송하라는 신호를 보낸다. (stop & wait를 이용해서 오류제어하는 방식)

#### Ack에 인한 오류제어

모든 세그먼트에 대하여 ack를 확인할 필요가 없다. TCP 프로토콜은 Ack5를 받으면 다음부터는 6부터 데이터를 송신하게 되어있따. 만약에 Ack=4가 소실되어도 오지 않아도 재전송를 하지 않는다. 클라이언트는 Ack이전 데이터를 모두 받았을 경우에만 Ack를 보내기 때문에, 그 이전 데이터는 안전하게 전송되었다는 것이 보장된다. 

#### CRC에 인한 오류제어

CRC에러가 나면 패킷이 로스된 것 처럼 취급한다. CRC 개념은 매우 단순하다. 세그먼트 단위를 32bit 단위로 쪼개고 각각을 더해준다. 이때 발생하는 오버플로우는 순환올림으로 사용된다. 이렇게 더해준 값의 1의 보수로 CRC를 보내주게 된다. 그러면 클라이언트가 각 세그먼트를 32bit 단위로 나누어서 더했을때 0이 나오지 않으면 에러가 난 것으로 판단한다. 

간단한 예시!

- http://www.ktword.co.kr/abbr_view.php?nav=&m_temp1=1477&id=744



### 혼잡 제어

혼잡제어는 생각보다 간단하다. 슬라이딩 윈도우 폭을 조절하여 단말간 속도를 제어하면 된다. 처음 통신이 시작되었을 때에는 슬라이딩 윈도우 사이즈를 작게했다가 점점 사이즈를 늘려나간다. 사이즈를 늘리다 보면 어느순간 에러가 발생하게 되고, 이 때 슬라이딩 윈도우 폭을 줄여 안정성있게 송수신하도록 맞춰나간다. 즉, 점점 슬라이딩 윈도우 사이즈를 늘려나가면서 손실이나면 윈도우 사이즈를 줄이고 아니면 올린다. 이것을 cwnd(Congestion window) 라고 한다 .



## IP가 부족해!!  IP 긴급 수혈이 필요하다. 

IPv4는 24bit로 표현되는 인터넷상에서의 고유 번호이다. 최근 IoT, 클라우드 시스템이 활성화됨에 따라 여러 사물이 인터넷을 사용할 수 있게 되어 수 많은 사물에 IP 번호를 할당하고 있다. 그런데 24bit를 쓰고 있는 IPv4는 진적에 IP가 고갈되어 새롭게 신청한 고객은 인터넷을 사용하지 못할것 같은데, 아직까지는 IPv4를 잘 이용하고 있다. 어떤 일이 일어났길래 아직도 IPv4를 잘 사용할 수 있을까? 

하나의 IP를 다수가 나눠 쓸 수 있도록 하는 기술이 적용하여 IP 번호 고갈로 인한 혼잡을 늦추고 있다. 이 해결책 중 하나는 바로 공유기를 이용하면 간단하게 사용가능하다. 

### 공유기

공유기란 사설IP를 가진 다수의 호스트가 공용 아이피 한개 를 나누어 사용하는 장비다.

### DHCP (Dynamic Host Configuration Protocol)

DHCP란 IP를 할당해서 임대로 제공해주는 방식이다. 호스트의 IP를 각종 TCP/IP 프로토콜 설정에 맞춰 클라이언트에게 자동적으로 제공해준다. 

### NAT (Network Address Translation) 테이블

IP자원은 소중하게 아껴쓰기 위해서는 여러 개의 Private IP를 하나의 Public IP를 나눠써야 한다. 하나의 Public IP로 나눠 쓰다보니 Private IP는 외부망으로 나갈 때, Public IP주소로 변환되어 나가야 한다. 공유기에 연결된 많은 호스트들의 IP를 어떻게 관리할 수 있을까? 이를 위한 해결책이 바로 Private IP와 Public IP를 변환을 도와주는 NAT이다.  

NAT는 NAT 테이블을 만들어 Private IP와 Public IP 정보를 저장해 놓는다. 여러 호스트가 적은 딜레이 시간으로 인터넷을 사용할 수 있도록 하기 위하여 Private IP와 사용 포트, 그리고 랜덤으로 지정한 Public IP와 포트를 연결해 놓는다. 그래서 유저는 아이피와 포트가 이미 사용중이라고 해서 대기하기 않고 다른 포트로 송수신할 수 있게 되는 것이다.

대부분은 NAT 테이블은 패킷을 보낼 때마다 다이나믹하게 추가된다고 보면된다. NAT 테이블을 통해서 하나의 공용 IP를 여러개의 사설 IP로 나눠쓸 수 있다. NAT 테이블은 매우 간단하다. 공유기를 통해서 나가는 사설 IP와 포트를 공용IP와 포트로 매칭시켜 놓는 것이다. 



## Reference

TCP 소개가 너무 깔끔하게 되어있따. 캬캬

https://evan-moon.github.io/2019/11/22/tcp-flow-control-error-control/




